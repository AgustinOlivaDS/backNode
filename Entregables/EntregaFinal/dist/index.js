(()=>{"use strict";var t={343:function(t,r,o){var i=this&&this.__awaiter||function(t,r,o,i){return new(o||(o=Promise))((function(e,s){function n(t){try{c(i.next(t))}catch(t){s(t)}}function d(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(t){t(r)}))).then(n,d)}c((i=i.apply(t,r||[])).next())}))},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const s=e(o(860)),n=o(930);var d=s.default.Router();const c=new n("./public/carritos.json");d.post("/",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=t.body;r.json(yield c.save(o))})))),d.delete("/:id",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id);r.json(yield c.deleteById(o))})))),d.get("/:id/productos",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id);r.json(yield c.getById(o).productos)})))),d.post("/:id/productos",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id),i=t.body;r.json(yield c.saveProductoById(o,i))})))),d.put("/:id",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id),i=t.body;r.json(yield c.update(o,i))})))),d.get("/:id/productos/:id_prod",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id),i=parseInt(t.params.id_prod);r.json(yield c.getProductoById(o,i))})))),d.delete("/:id/productos/:id_prod",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id),i=parseInt(t.params.id_prod);r.json(yield c.deleteProductoById(o,i))})))),d.get("/:id",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id);r.json(yield c.getById(o))})))),t.exports=d},559:function(t,r,o){var i=this&&this.__awaiter||function(t,r,o,i){return new(o||(o=Promise))((function(e,s){function n(t){try{c(i.next(t))}catch(t){s(t)}}function d(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(t){t(r)}))).then(n,d)}c((i=i.apply(t,r||[])).next())}))},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const s=e(o(860)),n=o(845);var d=s.default.Router();const c=new n("./public/productos.json");d.get("/",((t,r)=>i(void 0,void 0,void 0,(function*(){t.administrador?r.json(yield c.getAll()):(r.status(404),r.json({error:-1,descripcion:`Ruta ${t.baseUrl} método ${t.method} no autorizada`}))})))),d.get("/:id",((t,r)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(t.params.id);r.json(yield c.getById(o))})))),d.post("/",((t,r)=>i(void 0,void 0,void 0,(function*(){if(t.administrador){const o=t.body;r.json(yield c.save(o))}else r.status(404),r.json({error:-1,descripcion:`Ruta ${t.baseUrl} método ${t.method} no autorizada`})})))),d.put("/:id",((t,r)=>i(void 0,void 0,void 0,(function*(){if(t.administrador){const o=parseInt(t.params.id),i=t.body;r.json(yield c.update(o,i))}else r.status(404),r.json({error:-1,descripcion:`Ruta ${t.baseUrl} método ${t.method} no autorizada`})})))),d.delete("/:id",((t,r)=>i(void 0,void 0,void 0,(function*(){if(t.administrador){const o=parseInt(t.params.id);r.json(yield c.deleteById(o))}else r.status(404),r.json({error:-1,descripcion:`Ruta ${t.baseUrl} método ${t.method} no autorizada`})})))),t.exports=d},392:(t,r,o)=>{o(723),t.exports=class{constructor(){this.id=0,this.productos=[],this.id=0,this.timestamp=new Date,this.productos=[]}}},930:function(t,r,o){var i=this&&this.__awaiter||function(t,r,o,i){return new(o||(o=Promise))((function(e,s){function n(t){try{c(i.next(t))}catch(t){s(t)}}function d(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(t){t(r)}))).then(n,d)}c((i=i.apply(t,r||[])).next())}))};o(392);const{promises:e}=o(147);t.exports=class{constructor(t){this.carritos=[],this.ruta="",this.ruta=t}save(t){return i(this,void 0,void 0,(function*(){this.carritos=yield this.getAllFromFile(),this.carritos.length>0?t.id=this.carritos[this.carritos.length-1].id+1:t.id=1,t.timestamp=Date.now(),t.productos.forEach((t=>{t.timestamp=Date.now()})),this.carritos.push(t);try{yield e.writeFile(this.ruta,JSON.stringify(this.carritos,null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}return{error:"ok",id:t.id}}))}update(t,r){return i(this,void 0,void 0,(function*(){this.carritos=yield this.getAllFromFile();let o=this.carritos.findIndex((r=>r.id===t));if(console.log(o),-1===o)return{error:"Carrito no encontrado"};try{this.carritos[o].productos=r.productos;try{yield e.writeFile(this.ruta,JSON.stringify(this.carritos,null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}return{error:"ok",carritos:this.carritos[o]}}catch(t){return{error:t}}}))}getById(t){return i(this,void 0,void 0,(function*(){this.carritos=yield this.getAllFromFile();let r=this.carritos.find((r=>r.id===t));return void 0===r?{error:"Carrito no encontrado",carritos:r}:{error:"ok",carritos:r}}))}getProductoById(t,r){return i(this,void 0,void 0,(function*(){this.carritos=yield this.getAllFromFile();let o=this.carritos.findIndex((r=>r.id===t));if(void 0!==o){let t=this.carritos[o].productos.findIndex((t=>t.id===r));return void 0!==t?(this.carritos[o].productos.splice(t,1),{error:"ok",producto:t}):{error:`No existe producto con id: ${r}`}}return{error:`No existe carrito con id: ${t}`}}))}saveProductoById(t,r){return i(this,void 0,void 0,(function*(){this.carritos=yield this.getAllFromFile();let o=this.carritos.findIndex((r=>r.id===t));if(void 0!==o){this.carritos[o].productos.length>0?r.id=this.carritos[o].productos[this.carritos[o].productos.length-1].id+1:r.id=1,r.timestamp=Date.now(),this.carritos[o].productos.push(r);try{yield e.writeFile(this.ruta,JSON.stringify(this.carritos,null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}return{error:"ok"}}return{error:`No existe carrito con id: ${t}`}}))}getAll(){return i(this,void 0,void 0,(function*(){return this.carritos=yield this.getAllFromFile(),console.log(this.carritos),this.carritos.length>0?{error:"ok",carritos:this.carritos}:{error:"No existen carritos",carritos:this.carritos}}))}deleteById(t){return i(this,void 0,void 0,(function*(){this.carritos=yield this.getAllFromFile();let r=this.carritos.findIndex((r=>r.id===t));if(void 0!==r){this.carritos.splice(r,1);try{yield e.writeFile(this.ruta,JSON.stringify(this.carritos,null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}return{error:"Carrito Eliminado"}}return{error:`No existe carrito con id: ${t}`}}))}deleteProductoById(t,r){return i(this,void 0,void 0,(function*(){this.carritos=yield this.getAllFromFile();let o=this.carritos.findIndex((r=>r.id===t));if(void 0!==o){let t=this.carritos[o].productos.findIndex((t=>t.id===r));if(void 0!==t){this.carritos[o].productos.splice(t,1);try{yield e.writeFile(this.ruta,JSON.stringify(this.carritos,null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}return{error:"Producto Eliminado"}}return{error:`No existe producto con id: ${r}`}}return{error:`No existe carrito con id: ${t}`}}))}deleteAll(){return i(this,void 0,void 0,(function*(){try{yield e.writeFile(this.ruta,JSON.stringify([],null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}}))}getAllFromFile(){return i(this,void 0,void 0,(function*(){try{const t=yield e.readFile(this.ruta,"utf-8");return JSON.parse(t)}catch(t){return console.log(t),[]}}))}}},723:t=>{t.exports=class{constructor(){this.id=0,this.timestamp=new Date,this.nombre="",this.descripcion="",this.codigo=0,this.foto="",this.precio=0,this.stock=0}}},366:t=>{t.exports=class{constructor(){this.id=0,this.title="",this.price=0,this.thumbnail=""}}},845:function(t,r,o){var i=this&&this.__awaiter||function(t,r,o,i){return new(o||(o=Promise))((function(e,s){function n(t){try{c(i.next(t))}catch(t){s(t)}}function d(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(t){t(r)}))).then(n,d)}c((i=i.apply(t,r||[])).next())}))};o(366);const{promises:e}=o(147);t.exports=class{constructor(t){this.ruta="",this.products=new Array,this.ruta=t}save(t){return i(this,void 0,void 0,(function*(){this.products=yield this.getAllFromFile(),this.products.length>0?t.id=this.products[this.products.length-1].id+1:t.id=1,t.timestamp=Date.now(),this.products.push(t);try{yield fs.writeFile(this.ruta,JSON.stringify(this.products,null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}return{error:"ok",id:t.id}}))}update(t,r){return i(this,void 0,void 0,(function*(){this.products=yield this.getAllFromFile();let o=this.products.findIndex((r=>r.id===t));if(console.log(o),-1===o)return{error:"Producto no encontrado"};try{this.products[o].title=r.title,this.products[o].price=r.price,this.products[o].thumbnail=r.thumbnail;try{yield e.writeFile(this.ruta,JSON.stringify(this.products,null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}return{error:"ok",productos:this.products[o]}}catch(t){return{error:t}}}))}getById(t){return i(this,void 0,void 0,(function*(){try{this.products=yield this.getAllFromFile();let r=this.products.findIndex((r=>r.id===t));return-1===r?{error:"Producto no encontrado",productos:{}}:(console.log(this.products[r]),{error:"ok",productos:this.products[r]})}catch(t){return{error:t}}}))}getAll(){return i(this,void 0,void 0,(function*(){try{return this.products=yield this.getAllFromFile(),console.log(this.products),this.products.length>0?{error:"ok",productos:this.products}:(console.log("retornando algo"),{error:"No existen productos",productos:this.products})}catch(t){return{error:t}}}))}deleteById(t){return i(this,void 0,void 0,(function*(){this.products=yield this.getAllFromFile();let r=this.products.find((r=>r.id===t));if(void 0!==r){this.products.splice(r,1);try{yield e.writeFile(this.ruta,JSON.stringify(this.products,null,2))}catch(t){throw new Error(`Error al borrar por id: ${t}`)}return{error:"Producto Eliminado"}}return{error:`No existe producto con id: ${t}`}}))}deleteAll(){return i(this,void 0,void 0,(function*(){try{yield e.writeFile(this.ruta,JSON.stringify([],null,2))}catch(t){throw new Error(`Error al borrar todo: ${t}`)}}))}getAllFromFile(){return i(this,void 0,void 0,(function*(){try{const t=yield e.readFile(this.ruta,"utf-8");return JSON.parse(t)}catch(t){return console.log(t),[]}}))}}},860:t=>{t.exports=require("express")},147:t=>{t.exports=require("fs")}},r={};function o(i){var e=r[i];if(void 0!==e)return e.exports;var s=r[i]={exports:{}};return t[i].call(s.exports,s,s.exports,o),s.exports}(()=>{const t=o(860),r=t(),i=o(559),e=o(343);r.use(t.json()),r.use(t.urlencoded({extended:!0})),r.use((function(t,r,o){t.administrador=!0,console.log(`administrador ${t.administrador}`),o()})),r.use("/api/productos",i),r.use("/api/carrito",e),r.use((function(t,r,o){r.status(404),r.json({error:-2,descripcion:`Error 404. Ruta ${t.baseUrl} método ${t.method} no implementado`})})),r.use("/",t.static(__dirname+"/public"));const s=r.listen(8080,(()=>{console.log(`Server linstening on port ${s.address().port}`)}))})()})();